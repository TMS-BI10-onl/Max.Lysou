/*
1.
Для своей базы данных создайте объект для нахождения общего рейтинга топ 50 продавцов за всю историю продаж, 
где рейтинг определяется количеством баллов за количество продаж в день 
(10 и более продаж – 3 балла, 5-10 – 2 балла, меньше 5 – 1 балл). 
*/
DROP VIEW IF EXISTS [dbo].[vManagerRankingTop50];
GO
CREATE VIEW [dbo].[vManagerRankingTop50] AS
SELECT TOP 50 WITH TIES *,
	RANK() OVER(ORDER BY [ManagerScore] DESC) AS [ManagerRanking]
FROM
	(SELECT DISTINCT
		[IDManager],
		[FirstName],
		[LastName],
		[Position],
		SUM([DailyScore]) OVER(PARTITION BY [IDManager]) AS [ManagerScore]
	FROM
		(SELECT DISTINCT
			M.[IDManager],
			M.[FirstName],
			M.[LastName],
			M.[Position],
			S.[DataSales],
			COUNT(S.[DataSales]) OVER(PARTITION BY M.[IDManager],S.[DataSales]) AS [DailySales],
			CASE
				WHEN COUNT(S.[DataSales]) OVER(PARTITION BY M.[IDManager],S.[DataSales]) = 0 THEN 0
				WHEN COUNT(S.[DataSales]) OVER(PARTITION BY M.[IDManager],S.[DataSales]) < 5 THEN 1
				WHEN COUNT(S.[DataSales]) OVER(PARTITION BY M.[IDManager],S.[DataSales]) < 10 THEN 2
				ELSE 3
			END AS [DailyScore]
		FROM [TMSGroup2].[dbo].[ManagersDim] M
			LEFT JOIN [TMSGroup2].[dbo].[SalesFct] S
			ON M.[IDManager] = S.[IDManager]
	) T1
) T2
ORDER BY [ManagerScore] DESC;
GO
SELECT *
FROM [dbo].[vManagerRankingTop50];

/*
2
Изучите данные графики. Как можно улучшить каждый? Пришлите ваши предложения (текстом, реализовывать не надо), а позже разберем на занятии.

График 2a
	1) Убрать фон. Фон тяжелый для восприятия + тратит краску при печати.
	2) Убрать легенду. Легенда не дает дополнительную информацию, а лишь дубрирует подписи столбцов.
	3) Сделать столбцы гистограммы одноцветными. Раскраска столбцов в разные цвета не несет никакой смысловой нагрузки на данном графике.
	4) Убрать тень столбцов гистограммы. Без комментариев + лишняя краска при печати.

График 2b
	1) Во-первых, для данного сценария я бы использовал круговую диаграмму, т.к. у нас всего две категории: TOP4 и NEXT46 и исходя из названия
		авторы хотели показать долю / соотношение ТОП4 и всех остальных, а не абсолютное значение категорий.
Если все же оставлять такую диаграмму, то
	2) Сделать ось от 0, так как текущая ось искажает восприятие и создает ложный эффект большой разницы между 35 и 40 млн.
	3) Возможно стоит сделать её обычной столбчатой диаграммой / гистограммой, а не конусовой, т.к. данный тип усложняет восприятие и сбивает с идеи, которую хотят здесь донести.
	4) Убрать тень, 3D объём эффекты, сделать график на плоскости.

График 2с
	1) Сделать шрифт для подписей данных крупнее и читабельнее.
	2) Поменять на горизонтальное выравнивание подписей для горизонтальной оси ОХ либо вынести их в легенду.
	3) Подписать значения для столбиков диаграммы, чтобы их можно было сравнить, хотя из диаграммы видно, что они практически одинаковы.
	4) Возможно стоит так же перейти к круговой диаграмме.
*/